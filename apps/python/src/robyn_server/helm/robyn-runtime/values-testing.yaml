# Testing environment values for AKS deployment
# Namespace: testing
# Supabase: supabase-test (already deployed)
# vLLM: ministral-vllm (already deployed)

replicaCount: 1

image:
  repository: ghcr.io/l4b4r4b4b4/oap-langgraph-tools-agent/robyn-runtime
  tag: "0.0.0"
  pullPolicy: Always

# Use existing Supabase JWT secret from the testing namespace
existingSecret:
  name: "supabase-test-jwt"
  keys:
    supabaseKey: "anonKey"
    supabaseSecret: "secret"
    # OpenAI key not needed - using local vLLM
    openaiApiKey: ""
    langchainApiKey: ""

# Disable secret creation - we're using existing Supabase secrets
secrets:
  create: false

config:
  host: "0.0.0.0"
  port: 8081
  workers: 2
  devMode: true

  supabase:
    # Use internal Kubernetes DNS for Supabase Kong API gateway
    url: "http://supabase-test-supabase-kong.testing.svc.cluster.local:8000"

  llm:
    # Use local ministral vLLM in testing namespace
    openaiApiBase: "http://ministral-vllm.testing.svc.cluster.local/v1"
    modelName: "ministral"

  observability:
    langchainTracingV2: "false"
    langchainProject: "testing"

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi

# Disable autoscaling for testing
autoscaling:
  enabled: false

# Disable PDB for single replica testing
podDisruptionBudget:
  enabled: false

# Ingress disabled for testing - no public exposure yet
ingress:
  enabled: false

# Simplified service
service:
  type: ClusterIP
  port: 80
  targetPort: 8081

# Relaxed security for testing
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false # Relaxed for testing
  runAsNonRoot: true
  runAsUser: 1000

# Disable network policy for easier testing
networkPolicy:
  enabled: false

# Disable monitoring for testing (no Prometheus operator)
serviceMonitor:
  enabled: false

prometheusRule:
  enabled: false

# Faster health checks for testing
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Pod labels for testing
podLabels:
  app.kubernetes.io/component: runtime
  app.kubernetes.io/part-of: open-agent-platform
  environment: testing

# Node selector (optional - remove if not needed)
nodeSelector: {}

# Tolerations (optional)
tolerations: []

# Simple anti-affinity
affinity: {}

# Additional env vars for testing/debugging
env:
  - name: LOG_LEVEL
    value: "DEBUG"
  - name: PYTHONUNBUFFERED
    value: "1"
